%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#4A90D9', 'primaryTextColor': '#fff', 'primaryBorderColor': '#2E6CB5', 'lineColor': '#5C6BC0'}}}%%

flowchart LR
    subgraph DEFAULT["ðŸ”„ DEFAULT MODE"]
        direction LR
        D1["ðŸ“‹ PLAN"] --> D2["ðŸ”Ž REVIEW"] --> D3["âš™ï¸ EXECUTE"] --> D4["âœ“ VERIFY"] --> D5["ðŸ›¡ï¸ GATE"] --> D6{{"Pass?"}}
        D6 -->|"âœ…"| D7["âœ… COMPLETE"]
        D6 -->|"âŒ"| D8["ðŸ”§ DEBUG"] --> D3
    end
    
    subgraph RESEARCH_MODE["ðŸ”¬ RESEARCH MODE (--research)"]
        direction LR
        R1["ðŸ”Ž RESEARCH"] --> R2["ðŸ“‹ PLAN"] --> R3["ðŸ”Ž REVIEW"] --> R4["âš™ï¸ EXECUTE"] --> R5["âœ“ VERIFY"] --> R6["ðŸ›¡ï¸ GATE"] --> R7{{"Pass?"}}
        R7 -->|"âœ…"| R8["âœ… COMPLETE"]
        R7 -->|"âŒ"| R9["ðŸ”§ DEBUG"] --> R4
    end
    
    subgraph FULL_RESEARCH["ðŸ”¬ FULL RESEARCH MODE (--full-research)"]
        direction LR
        F0["ðŸ” ANALYST"] --> F1["ðŸ”Ž SCOUT"] --> F2["ðŸ“‹ PLAN"] --> F3["ðŸ”Ž REVIEW"] --> F4["âš™ï¸ EXECUTE"] --> F5["âœ“ VERIFY"] --> F6["ðŸ›¡ï¸ GATE"] --> F7{{"Pass?"}}
        F7 -->|"âœ…"| F8["âœ… COMPLETE"]
        F7 -->|"âŒ"| F9["ðŸ”§ DEBUG"] --> F4
    end
    
    subgraph QUICK_MODE["âš¡ QUICK MODE (--quick)"]
        direction LR
        Q1["ðŸ“‹ PLAN"] --> Q2["âš™ï¸ EXECUTE"] --> Q3["âœ“ VERIFY"] --> Q4{{"Pass?"}}
        Q4 -->|"âœ…"| Q5["âœ… COMPLETE"]
        Q4 -->|"âŒ"| Q6["ðŸ”§ DEBUG"] --> Q2
    end
    
    subgraph RESUME_MODE["ðŸ” RESUME MODE (--resume)"]
        direction LR
        RS1[("ðŸ“„ STATE.md")] --> RS2{{"Last Stage?"}}
        RS2 -->|"PLANNING"| RS3["ðŸ“‹ PLAN"]
        RS2 -->|"EXECUTING"| RS4["âš™ï¸ EXECUTE"]
        RS2 -->|"VERIFYING"| RS5["âœ“ VERIFY"]
        RS2 -->|"DEBUGGING"| RS6["ðŸ”§ DEBUG"]
        RS3 --> RS7["... continue"]
        RS4 --> RS7
        RS5 --> RS7
        RS6 --> RS7
    end

    %% Styling
    classDef research fill:#E3F2FD,stroke:#1976D2
    classDef plan fill:#E8F5E9,stroke:#388E3C
    classDef review fill:#FFF3E0,stroke:#F57C00
    classDef execute fill:#F3E5F5,stroke:#7B1FA2
    classDef verify fill:#E0F7FA,stroke:#0097A7
    classDef gate fill:#FCE4EC,stroke:#C2185B
    classDef debug fill:#FFEBEE,stroke:#D32F2F
    classDef complete fill:#C8E6C9,stroke:#2E7D32,stroke-width:2px
    classDef decision fill:#E1BEE7,stroke:#8E24AA

    class R1,F0,F1 research
    class D1,R2,F2,Q1,RS3 plan
    class D2,R3,F3 review
    class D3,R4,F4,Q2,RS4 execute
    class D4,R5,F5,Q3,RS5 verify
    class D5,R6,F6 gate
    class D8,R9,F9,Q6,RS6 debug
    class D7,R8,F8,Q5 complete
    class D6,R7,F7,Q4,RS2 decision
